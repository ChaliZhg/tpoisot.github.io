<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8" />
   <link rel="stylesheet" href="/css/normalize.css">
	<link rel="stylesheet" href="/css/foundation.min.css">
   <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
   <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
	<link rel="stylesheet" href="/css/d3.css" />
	<link rel="stylesheet" href="/css/pygments.css" />
   <link rel="stylesheet/less" type="text/css" href="/css/tim.less" />
   <script type="text/javascript" src="/lib/less.js"></script>
   <script src="http://d3js.org/d3.v3.min.js"></script>
   <link rel="alternate" type="application/atom+xml" title="RSS Feed for Tim's blog" href="http://feeds.feedburner.com/timpoisot" />
    
    <script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-11830706-1']);
		_gaq.push(['_trackPageview']);

		(function() {
		 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>
	
	<meta name="author" content="Tim Poisot" />
   <title>Timothée Poisot :: The aggregate function in Python</title>
    
</head>

<body>
<a id="top"></a>
<div id="main">

<div class="row content">
   <div class = "row copy">
   <div class="large-9 small-10 columns maintext">
   <div class='post'>
<h1>The aggregate function in Python</h1>

   <div class="postinfo">
      December  1, 2011 &mdash; <span class="label radius small secondary" style="margin-right: 3px;"><a href="/tag/python/">python</a></span><span class="label radius small secondary" style="margin-right: 3px;"><a href="/tag/R/">R</a></span><span class="label radius small secondary" style="margin-right: 3px;"><a href="/tag/scipy/">scipy</a></span>
   </div>


<p>One thing I love the most about R is the <a href="http://stat.ethz.ch/R-manual/R-devel/library/stats/html/aggregate.html">aggregate</a> function, which (in a nutshell) summarizes a data frame according to one or more columns, and perform some operations on the aggregated values. If, for example, you have a data frame with a treatment and a response, and want to calculate the mean and standard deviation of the response by level of treatment, then aggregate is usually the way to go.</p>

<p>I wanted to do a quick <a href="http://pyx.sourceforge.net/examples/graphstyles/errorbar.html">plot with errorbars using PyX</a>, and I though that having a python version of aggregate would be really nice. Here is the complete code to do so</p>

<div class="highlight"><pre><code class="python"><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="kn">as</span> <span class="nn">sp</span>  

<span class="k">def</span> <span class="nf">MSD</span><span class="p">(</span><span class="n">vec</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vec</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">vec</span><span class="p">)]</span>  
<span class="k">def</span> <span class="nf">aggregate</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">to</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">func</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">):</span>
    <span class="n">Dat</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ColBy</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">by</span><span class="p">]</span>
    <span class="n">ColTo</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">to</span><span class="p">]</span>
    <span class="n">UniqueBy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ColBy</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">ub</span> <span class="ow">in</span> <span class="n">UniqueBy</span><span class="p">:</span>
        <span class="n">uTo</span> <span class="o">=</span> <span class="n">ColTo</span><span class="p">[</span><span class="n">ColBy</span><span class="o">==</span><span class="n">ub</span><span class="p">]</span>
        <span class="n">Out</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">uTo</span><span class="p">)</span>
        <span class="n">Dat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(([</span><span class="n">ub</span><span class="p">],</span><span class="n">Out</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">Dat</span>  
    
<span class="n">test_df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s">&#39;tes1-output.dat&#39;</span><span class="p">)</span>  
<span class="n">Agr</span> <span class="o">=</span> <span class="n">aggregate</span><span class="p">(</span><span class="n">test_df</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="n">MSD</span><span class="p">)</span>
<span class="n">sp</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="s">&quot;aggr.dat&quot;</span><span class="p">,</span> <span class="n">Agr</span><span class="p">)</span>  
<span class="kn">from</span> <span class="nn">pyx</span> <span class="kn">import</span> <span class="o">*</span>  
<span class="n">g</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">graphxy</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">file</span><span class="p">(</span><span class="s">&quot;aggr.dat&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dy</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
    <span class="p">[</span><span class="n">graph</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">symbol</span><span class="p">(),</span> <span class="n">graph</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">errorbar</span><span class="p">()])</span>
<span class="n">g</span><span class="o">.</span><span class="n">writePDFfile</span><span class="p">(</span><span class="s">&quot;errorbar&quot;</span><span class="p">)</span>
</code></pre></div>

<p>As you can see, it is really straightforward. The aggregate function needs four arguments: the data frame (in this case, a numpy array with two dimensions), the column for the group to aggregate, and the column for the response. The last argument is obviously the function which will be applied, in this case a simple mean ± standard deviation. In 30 lines of code, you can easily aggregate your data using python. Of course there is room for improvement, but this is already working quite well.</p>


</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'tpoi-hp'; // required: replace example with your forum shortname

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

<ul class="pager">


<li class="previous">
<a href="/2011/11/19/get-your-lab-on-twitter/">&larr; Previous post</a>
</li>



<li class="next">
<a href="/2012/01/01/migration-to-jekyll/">Next post &rarr;</a>
</li>


</ul>


   </div>
   <div class="large-3 small-2 columns">
      <div class='header'>
         <h1>Timothée Poisot</h1>
<h2>Spatial ecology of species interactions</h2>

         <ul class="no-bullet main-nav">
   <li><a href="/">Home</a></li>
   <li><a href="/papers/">Papers</a></li>
   <li><a href="/software/">Software</a></li>
   <li><a href="/research/">Research</a></li>
   <li class="active"><a href="/blog/">Blog</a></li>
</ul>

         <a class='top' href="#top"><i class="fa fa-arrow-circle-up"></i></a>
      </div>
   </div>
   </div>

   <div class="row footer">
         <div class="small-4 columns">
<h5>Contact</h5>
<ul class='no-bullet'>
   <li><i class="fa fa-fw fa-envelope"></i> <a href="mailto:t.poisot@gmail.com">E-mail</a></li>
   <li><i class="fa fa-fw fa-twitter-square"></i> <code>@tpoi</code> on <a href="http://twitter.com/tpoi/">Twitter</a></li>
   <li><i class="fa fa-fw fa-github-square"></i> <code>tpoisot</code> on <a href="http://github.com/tpoisot/">GitHub</a></li>
   <li><i class="fa fa-fw fa-rss-square"></i> <a href="http://feeds.feedburner.com/timpoisot/">RSS feed for new posts</a></li>
</ul>
</div>

<div class="small-8 columns">
   <h5>Most recent posts</h5>
   <ul class='no-bullet'>
   
   <li><span class='date'>11 Jan 2014</span> <a href="/2014/01/11/animate-networks-with-igraph/">Animate networks with igraph</a></li>
   
   <li><span class='date'>09 Jan 2014</span> <a href="/2014/01/09/mangal-in-action/">Examples of mangal in action</a></li>
   
   <li><span class='date'>08 Jan 2014</span> <a href="/2014/01/08/mangal-add-data/">Uploading data into mangal</a></li>
   
   <li><span class='date'>07 Jan 2014</span> <a href="/2014/01/07/mangal-database-networks/">Introducing mangal, a database for ecological networks</a></li>
   
   </ul>
</div>


<div class="small-8 columns">
   <h5>Colophon</h5>
   <p>
	  This website uses <a href='http://foundation.zurb.com/'>Foundation
	  5</a>, <a href='http://fortawesome.github.io/Font-Awesome/'>Font
	  Awesome</a>, is built with <a
	  href='https://github.com/mojombo/jekyll'>Jekyll</a>, and hosted by <a
	  href='http://pages.github.com/'>GitHub pages</a>. Contents under the
	  <a href='http://creativecommons.org/licenses/by-sa/3.0/deed.en_US'>CC
	  BY-SA 3.0</a> licence.
   </p>
</div>


   </div>

</div>


</div>

</body>

</html>
