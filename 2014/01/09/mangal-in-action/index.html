<!DOCTYPE html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
extensions: ["tex2jax.js"],
jax: ["input/TeX", "output/HTML-CSS"],
tex2jax: {
inlineMath: [ ['$','$'], ["\\(","\\)"] ],
displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
processEscapes: true
},
"HTML-CSS": { availableFonts: ["TeX"] }
});
</script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

<link href="/lib/fontawesome/css/font-awesome.min.css" rel="stylesheet">

<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
   (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
   m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-11830706-1', 'timotheepoisot.fr');
ga('send', 'pageview');
</script>

<link rel="stylesheet" href="/lib/skeleton/css/normalize.css">
<link rel="stylesheet" href="/lib/skeleton/css/skeleton.css">

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script type="text/javascript" src="/lib/site.js" charset="utf-8"></script>

<link rel="stylesheet/less" type="text/css" href="/lib/style.less" />
<script type="text/javascript" src="/lib/less.min.js" charset="utf-8"></script>

<title>Timothée Poisot | Examples of mangal in action</title>

  </head>
  <body><a id="pagetop"></a>

    <!-- .container is main centered wrapper -->
    <div class="container">

      <div class="head">
        <h1>Timothée Poisot</h1>
        <h2>Computational Ecologist</h2>
      </div>

      <nav class="navbar">
  <div class="container">
    <ul class="nav-list">
      <li>
        <a href="/">
          <span class="icon"><i class="fa fa-fw fa-home"></i>
          </span><span class="text">Home</span>
        </a>
      </li>
      <li>
        <a href="/software/">
          <span class="icon"><i class="fa fa-fw fa-terminal"></i>
          </span><span class="text">Software</span>
        </a>
      </li>
      <li>
        <a href="/research/">
          <span class="icon"><i class="fa fa-fw fa-flask"></i>
          </span><span class="text">Research</span>
        </a>
      </li>
      <li>
        <a href="/blog/" class="active">
          <span class="icon"><i class="fa fa-fw fa-bullhorn"></i>
          </span><span class="text">Blog</span>
        </a>
      </li>
      <li>
        <a href="/papers/">
          <span class="icon"><i class="fa fa-fw fa-file-text-o"></i>
          </span><span class="text">Papers</span>
        </a>
      </li>
      <li>
        <a href="/colophon/">
          <span class="icon"><i class="fa fa-fw fa-info"></i>
          </span><span class="text">Colophon</span>
        </a>
      </li>
    </ul>
  </div>
</nav>


      <!-- columns should be the immediate child of a .row -->
      <div class="row">
        <div class="twelve column content">
          <div class="entry">
<div class='post-title'>2014/01/09<a class="readmore" href="/2014/01/09/mangal-in-action/">Examples of mangal in action</a></div>
<div class='post-meta'>Written by Tim</div>
<p>In the two previous posts (see <a href="http://timotheepoisot.fr/2014/01/07/mangal-database-networks/">Part 1</a> and <a href="http://timotheepoisot.fr/2014/01/08/mangal-add-data/">Part 2</a>), I&#39;ve presented the basics of using <code>mangal</code> and the <code>rmangal</code> package to access, deposit, and edit data about ecological networks. The final post in the series is going to be slightly more fun: I&#39;ll illustrate some use cases of things you can potentially do with the database. We will start from the representation of a network in space, then move on to measuring beta-diversity in the dataset, and end with some more classical species-links relationships.</p>

<h1 id="setting-things-up">Setting things up</h1>

<p>We&#39;ll need to pull the latest version of <code>rmangal</code>, as usual. In addition, we&#39;ll need a few other packages.</p>
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">options</span><span class="p">(</span><span class="n">stringsAsFactors</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">)</span>
<span class="k">if</span> <span class="p">(</span><span class="n">getOption</span><span class="p">(</span><span class="s2">"unzip"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">""</span><span class="p">)</span> <span class="n">options</span><span class="p">(</span><span class="n">unzip</span> <span class="o">=</span> <span class="s2">"unzip"</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">devtools</span><span class="p">)</span>
<span class="n">install_github</span><span class="p">(</span><span class="s2">"rmangal"</span><span class="p">,</span> <span class="s2">"mangal-wg"</span><span class="p">)</span>
<span class="n">install_github</span><span class="p">(</span><span class="s2">"betalink"</span><span class="p">,</span> <span class="s2">"tpoisot"</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">rmangal</span><span class="p">)</span>
<span class="c1"># Let's connect to the database
</span><span class="n">URL</span> <span class="o">&lt;-</span> <span class="s2">"http://localhost:8000"</span>
<span class="n">api</span> <span class="o">&lt;-</span> <span class="n">rmangal</span><span class="o">::</span><span class="n">mangalapi</span><span class="p">(</span><span class="n">URL</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">betalink</span><span class="p">)</span>
<span class="c1"># Tools for spatial analyses
</span><span class="n">library</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">RgoogleMaps</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">RColorBrewer</span><span class="p">)</span>
</code></pre></div>
<p><span class="margin">Ricciardi et al. (2010) <em>Env Biol Fishes</em> <a href="http://dx.doi.org/10.1007/s10641-010-9606-0">DOI</a></span>I will do everything using a dataset released by Ricciardi and colleagues. The <a href="http://www.nceas.ucsb.edu/interactionweb/html/ricciardi-et-al-2010.html">original data</a> are on the <em>Interaction Web DataBase</em>. This dataset describes 16 anemonefish/fishes mutualistic networks in Indonesia. It&#39;s an extremely cool dataset, because (i) there are a lot of sites in a small space, (ii) a lot of species are in common across sites, and (iii) anemonefishes. So I&#39;ve uploaded these data in my local copy of the database, and I&#39;m going to illustrate a few uses-cases. The only &quot;manual&quot; operation was determining the spatial coordinates in each networks, based on the map presented in the original paper.</p>

<h1 id="use-case-1:-spatialized-network">Use-case 1: spatialized network</h1>

<p><span class='margin'>Bascompte (2009) <em>Science</em> <a href="http://dx.doi.org/10.1126/science.1170749">DOI</a></span>There is a really cool figure in one of Jordi Bascompte&#39;s paper, in which a network is plotted in space, and the position of each species is the center of mass of its area. This is an interesting way to plot networks when spatial information is available, so let&#39;s do just that.</p>

<p>We start by getting the dataset:</p>
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">Dataset</span> <span class="o">&lt;-</span> <span class="n">getDataset</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="m">8</span><span class="p">)</span>
<span class="n">Dataset</span><span class="o">$</span><span class="n">networks</span>
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">##  [1] "32" "33" "18" "19" "20" "21" "22" "23" "24" "25" "26" "27" "28" "29"
## [15] "30" "31"
</code></pre></div>
<p>Now, this dataset has a lot of networks. So we&#39;ll do to things. First, we will get a list of all network objects, because they have the metadata we need:</p>
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">Networks</span> <span class="o">&lt;-</span> <span class="n">alply</span><span class="p">(</span><span class="n">Dataset</span><span class="o">$</span><span class="n">networks</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">getNetwork</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
<span class="n">Networks</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="o">$</span><span class="n">latitude</span>
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">## [1] 1.651
</code></pre></div>
<p>Next, we will call the <code>network_as_graph</code> function to get all the interactions, and associated informations on the taxa. We will also convert these graphs into matrices, because that will be easier for some of the next steps.</p>
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">Graphs</span> <span class="o">&lt;-</span> <span class="n">llply</span><span class="p">(</span><span class="n">Networks</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">network_as_graph</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="n">x</span><span class="o">$</span><span class="n">id</span><span class="p">))</span>
<span class="n">names</span><span class="p">(</span><span class="n">Graphs</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="n">laply</span><span class="p">(</span><span class="n">Networks</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">x</span><span class="o">$</span><span class="n">name</span><span class="p">)</span>
<span class="n">Matrices</span> <span class="o">&lt;-</span> <span class="n">llply</span><span class="p">(</span><span class="n">Graphs</span><span class="p">,</span> <span class="n">get.adjacency</span><span class="p">,</span> <span class="n">sparse</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">)</span>
</code></pre></div>
<p>Let&#39;s now get a table with the sites spatial coordinates:</p>
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">Coord</span> <span class="o">&lt;-</span> <span class="n">ldply</span><span class="p">(</span><span class="n">Networks</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">c</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">x</span><span class="o">$</span><span class="n">name</span><span class="p">,</span> <span class="n">lon</span> <span class="o">=</span> <span class="n">x</span><span class="o">$</span><span class="n">longitude</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">x</span><span class="o">$</span><span class="n">latitude</span><span class="p">))</span>
<span class="n">rownames</span><span class="p">(</span><span class="n">Coord</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="n">Coord</span><span class="o">$</span><span class="n">name</span>
<span class="n">Coord</span> <span class="o">&lt;-</span> <span class="n">Coord</span><span class="p">[,</span> <span class="n">c</span><span class="p">(</span><span class="s2">"lat"</span><span class="p">,</span> <span class="s2">"lon"</span><span class="p">)]</span>
<span class="n">Coord</span><span class="o">$</span><span class="n">lat</span> <span class="o">&lt;-</span> <span class="n">as.numeric</span><span class="p">(</span><span class="n">Coord</span><span class="o">$</span><span class="n">lat</span><span class="p">)</span>
<span class="n">Coord</span><span class="o">$</span><span class="n">lon</span> <span class="o">&lt;-</span> <span class="n">as.numeric</span><span class="p">(</span><span class="n">Coord</span><span class="o">$</span><span class="n">lon</span><span class="p">)</span>
<span class="n">head</span><span class="p">(</span><span class="n">Coord</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">##                 lat   lon
## Tanjung Kopi  1.651 124.7
## Tanjung Pisok 1.578 124.8
## bahowo        1.585 124.8
## Kampung Bajo  1.608 124.9
## Batu Kapal    1.788 124.8
## Bualo         1.616 124.7
</code></pre></div>
<p>Good!</p>

<p>Almost final steps, let&#39;s (i) get the list of species in each site, (ii) make a community matrix from this, and (iii) calculate the center of mass of each species based on its occurence in each of the 16 locations. </p>
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Get the list of species
</span><span class="n">sp_by_site</span> <span class="o">&lt;-</span> <span class="n">llply</span><span class="p">(</span><span class="n">Graphs</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">unlist</span><span class="p">(</span><span class="n">V</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">$</span><span class="n">name</span><span class="p">))</span>
<span class="n">sp_list</span> <span class="o">&lt;-</span> <span class="n">unique</span><span class="p">(</span><span class="n">unlist</span><span class="p">(</span><span class="n">sp_by_site</span><span class="p">))</span>

<span class="c1"># Species-by-site matrix
</span><span class="n">M</span> <span class="o">&lt;-</span> <span class="n">matrix</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">ncol</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">sp_list</span><span class="p">),</span> <span class="n">nrow</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">sp_by_site</span><span class="p">))</span>
<span class="n">colnames</span><span class="p">(</span><span class="n">M</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="n">sp_list</span>
<span class="n">rownames</span><span class="p">(</span><span class="n">M</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="n">names</span><span class="p">(</span><span class="n">sp_by_site</span><span class="p">)</span>
<span class="k">for</span> <span class="p">(</span><span class="n">site</span> <span class="k">in</span> <span class="n">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">length</span><span class="p">(</span><span class="n">sp_by_site</span><span class="p">)))</span> <span class="n">M</span><span class="p">[</span><span class="n">names</span><span class="p">(</span><span class="n">sp_by_site</span><span class="p">)[</span><span class="n">site</span><span class="p">],</span> <span class="n">sp_by_site</span><span class="p">[[</span><span class="n">site</span><span class="p">]]]</span> <span class="o">=</span> <span class="m">1</span>

<span class="c1"># Get the center of mass for each species
</span><span class="n">sp_center</span> <span class="o">&lt;-</span> <span class="n">adply</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">colMeans</span><span class="p">(</span><span class="n">Coord</span><span class="p">[</span><span class="n">names</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="n">x</span> <span class="o">&gt;</span> <span class="m">0</span><span class="p">],</span> <span class="p">]))</span>
<span class="n">rownames</span><span class="p">(</span><span class="n">sp_center</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="n">sp_center</span><span class="p">[,</span> <span class="m">1</span><span class="p">]</span>
<span class="n">sp_center</span> <span class="o">&lt;-</span> <span class="n">sp_center</span><span class="p">[,</span> <span class="m">-1</span><span class="p">]</span>
<span class="n">head</span><span class="p">(</span><span class="n">sp_center</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">##                           lat   lon
## Entacmaea quadricolor   1.599 124.8
## Heteractis aurora       1.677 124.8
## Heteractis crispa       1.614 124.8
## Stichodactyla mertensii 1.625 124.8
## Heteractis magnifica    1.601 124.8
## Amphiprion melanopus    1.620 124.7
</code></pre></div>
<p>Finally, we use the <code>metaweb</code> function from <code>betalink</code> to get the regional network, as an <code>igraph</code> graph:</p>
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">Mw</span> <span class="o">&lt;-</span> <span class="n">graph.adjacency</span><span class="p">(</span><span class="n">metaweb</span><span class="p">(</span><span class="n">Matrices</span><span class="p">)</span><span class="o">$</span><span class="n">web</span><span class="p">)</span>
</code></pre></div>
<p>And now, we&#39;ll use the <code>RgoogleMaps</code> package to plot a map, and overlay the spatialized network on top:</p>
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># But first we need this function to convert spatial coordinates
</span><span class="n">ll_to_gm</span> <span class="o">&lt;-</span> <span class="k">function</span><span class="p">(</span><span class="n">Map</span><span class="p">,</span> <span class="n">ll</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1"># Lat. conversion
</span>    <span class="n">lat</span> <span class="o">&lt;-</span> <span class="n">ll</span><span class="o">$</span><span class="n">lat</span>
    <span class="n">lat</span> <span class="o">&lt;-</span> <span class="n">lat</span> <span class="o">-</span> <span class="n">Map</span><span class="o">$</span><span class="n">lat.center</span>
    <span class="n">lat</span> <span class="o">&lt;-</span> <span class="n">lat</span><span class="o">/</span><span class="p">(</span><span class="n">Map</span><span class="o">$</span><span class="n">BBOX</span><span class="o">$</span><span class="n">ur</span><span class="p">[,</span> <span class="s2">"lat"</span><span class="p">]</span> <span class="o">-</span> <span class="n">Map</span><span class="o">$</span><span class="n">BBOX</span><span class="o">$</span><span class="n">ll</span><span class="p">[,</span> <span class="s2">"lat"</span><span class="p">])</span>
    <span class="n">lat</span> <span class="o">&lt;-</span> <span class="n">lat</span> <span class="o">*</span> <span class="m">640</span>
    <span class="c1"># Lat. conversion
</span>    <span class="n">lon</span> <span class="o">&lt;-</span> <span class="n">ll</span><span class="o">$</span><span class="n">lon</span>
    <span class="n">lon</span> <span class="o">&lt;-</span> <span class="n">lon</span> <span class="o">-</span> <span class="n">Map</span><span class="o">$</span><span class="n">lon.center</span>
    <span class="n">lon</span> <span class="o">&lt;-</span> <span class="n">lon</span><span class="o">/</span><span class="p">(</span><span class="n">Map</span><span class="o">$</span><span class="n">BBOX</span><span class="o">$</span><span class="n">ur</span><span class="p">[,</span> <span class="s2">"lon"</span><span class="p">]</span> <span class="o">-</span> <span class="n">Map</span><span class="o">$</span><span class="n">BBOX</span><span class="o">$</span><span class="n">ll</span><span class="p">[,</span> <span class="s2">"lon"</span><span class="p">])</span>
    <span class="n">lon</span> <span class="o">&lt;-</span> <span class="n">lon</span> <span class="o">*</span> <span class="m">640</span>
    <span class="c1">## Return matrix
</span>    <span class="k">return</span><span class="p">(</span><span class="n">cbind</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">))</span>
<span class="p">}</span>
<span class="c1"># Plot a map
</span><span class="n">center_point</span> <span class="o">&lt;-</span> <span class="n">colMeans</span><span class="p">(</span><span class="n">sp_center</span><span class="p">)</span>
<span class="n">Map</span> <span class="o">&lt;-</span> <span class="n">GetMap</span><span class="p">(</span><span class="n">center</span> <span class="o">=</span> <span class="n">center_point</span><span class="p">,</span> <span class="n">zoom</span> <span class="o">=</span> <span class="m">11</span><span class="p">,</span> <span class="n">SCALE</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span>
<span class="n">par</span><span class="p">(</span><span class="n">pty</span> <span class="o">=</span> <span class="s2">"s"</span><span class="p">)</span>
<span class="n">colors</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="n">brewer.pal</span><span class="p">(</span><span class="m">9</span><span class="p">,</span> <span class="s2">"Set1"</span><span class="p">),</span> <span class="n">brewer.pal</span><span class="p">(</span><span class="m">8</span><span class="p">,</span> <span class="s2">"Set2"</span><span class="p">))</span>
<span class="n">PlotOnStaticMap</span><span class="p">(</span><span class="n">Map</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">Mw</span><span class="p">,</span> <span class="n">layout</span> <span class="o">=</span> <span class="n">jitter</span><span class="p">(</span><span class="n">ll_to_gm</span><span class="p">(</span><span class="n">Map</span><span class="p">,</span> <span class="n">sp_center</span><span class="p">),</span> <span class="n">amount</span> <span class="o">=</span> <span class="m">10</span><span class="p">),</span> <span class="n">rescale</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> 
    <span class="n">add</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">vertex.size</span> <span class="o">=</span> <span class="m">600</span><span class="p">,</span> <span class="n">vertex.label</span> <span class="o">=</span> <span class="n">NA</span><span class="p">,</span> <span class="n">vertex.color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> 
    <span class="n">edge.arrow.size</span> <span class="o">=</span> <span class="m">0.25</span><span class="p">,</span> <span class="n">edge.color</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span>
<span class="n">legend</span><span class="p">(</span><span class="s2">"bottomleft"</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="n">V</span><span class="p">(</span><span class="n">Mw</span><span class="p">)</span><span class="o">$</span><span class="n">name</span><span class="p">,</span> <span class="n">inset</span> <span class="o">=</span> <span class="m">0.02</span><span class="p">,</span> <span class="n">cex</span> <span class="o">=</span> <span class="m">0.7</span><span class="p">,</span> 
    <span class="n">bty</span> <span class="o">=</span> <span class="s2">"n"</span><span class="p">)</span>
</code></pre></div>
<p><img src="/rfig/mangal_make_map_network.png" alt="plot of chunk mangal_make_map_network"> </p>

<p>And here we are! It might not be the best-looking graph ever, but I was fairly surprised that it was so easy to produce.</p>

<h1 id="use-case-2:-network-&beta;-diversity">Use-case 2: network &beta;-diversity</h1>

<p>For use-case number two, I will use the functions in <code>betalink</code> to do a quick illustration of how network &beta;-diversity depends on the distance between two networks. In the first use case, we have created a <code>Matrices</code> objects, which is a list of matrices. So we can simply do:</p>
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">bdiv</span> <span class="o">&lt;-</span> <span class="n">betalink.dist</span><span class="p">(</span><span class="n">Matrices</span><span class="p">)</span>
</code></pre></div>
<p>We&#39;ll add the spatial distance between sites, using a function from the <code>sp</code>:</p>
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">GeoDist</span> <span class="o">&lt;-</span> <span class="n">spDists</span><span class="p">(</span><span class="n">as.matrix</span><span class="p">(</span><span class="n">Coord</span><span class="p">),</span> <span class="n">longlat</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span>
<span class="n">colnames</span><span class="p">(</span><span class="n">GeoDist</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="n">rownames</span><span class="p">(</span><span class="n">GeoDist</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="n">rownames</span><span class="p">(</span><span class="n">Coord</span><span class="p">)</span>
<span class="n">bdiv</span><span class="o">$</span><span class="n">Space</span> <span class="o">&lt;-</span> <span class="n">as.dist</span><span class="p">(</span><span class="n">GeoDist</span><span class="p">)</span>
</code></pre></div>
<p>And now, some plots:</p>
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">par</span><span class="p">(</span><span class="n">mfcol</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">))</span>
<span class="n">with</span><span class="p">(</span><span class="n">bdiv</span><span class="p">,</span> <span class="p">{</span>
    <span class="n">plot</span><span class="p">(</span><span class="n">Space</span><span class="p">,</span> <span class="n">WN</span><span class="p">,</span> <span class="n">pch</span> <span class="o">=</span> <span class="m">19</span><span class="p">,</span> <span class="n">xlab</span> <span class="o">=</span> <span class="s2">"Distance (in km.)"</span><span class="p">,</span> <span class="n">ylab</span> <span class="o">=</span> <span class="s2">"Network dissim. (all species)"</span><span class="p">)</span>
    <span class="n">plot</span><span class="p">(</span><span class="n">Space</span><span class="p">,</span> <span class="n">OS</span><span class="p">,</span> <span class="n">pch</span> <span class="o">=</span> <span class="m">19</span><span class="p">,</span> <span class="n">xlab</span> <span class="o">=</span> <span class="s2">"Distance (in km.)"</span><span class="p">,</span> <span class="n">ylab</span> <span class="o">=</span> <span class="s2">"Network dissim. (common species)"</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div>
<p><img src="/rfig/betadiv_rmangal_plots.png" alt="plot of chunk betadiv_rmangal_plots"> </p>

<p>And here is a cool new mini-result: the dissimilarity of networks increases with distance overal, but not when you only account for the species which are shared between two locations.</p>

<h1 id="use-case-3:-link-species-relationships">Use-case 3: link-species relationships</h1>

<p>Let&#39;s end with a more classical example: in this system, what is the relationship between number of species (S), and number of interactions (L)? This information is super easy to get with a little bit of <code>plyr</code> magic:</p>
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">LS</span> <span class="o">&lt;-</span> <span class="n">ldply</span><span class="p">(</span><span class="n">Graphs</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">c</span><span class="p">(</span><span class="n">S</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">V</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">L</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">E</span><span class="p">(</span><span class="n">x</span><span class="p">))))</span>
<span class="n">head</span><span class="p">(</span><span class="n">LS</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">##             .id  S  L
## 1  Tanjung Kopi 10  8
## 2 Tanjung Pisok  9  7
## 3        bahowo 11 10
## 4  Kampung Bajo  6  4
## 5    Batu Kapal  5  4
## 6         Bualo  9  8
</code></pre></div>
<p>The only thing left is to plot this table:</p>
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">plot</span><span class="p">(</span><span class="n">LS</span><span class="p">[,</span> <span class="n">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">)],</span> <span class="n">log</span> <span class="o">=</span> <span class="s2">"xy"</span><span class="p">,</span> <span class="n">xlab</span> <span class="o">=</span> <span class="s2">"Species"</span><span class="p">,</span> <span class="n">ylab</span> <span class="o">=</span> <span class="s2">"Links"</span><span class="p">,</span> <span class="n">pch</span> <span class="o">=</span> <span class="m">19</span><span class="p">)</span>
</code></pre></div>
<p><img src="/rfig/mangal_demo_ls_png.png" alt="plot of chunk mangal_demo_ls.png"> </p>

<p>We find the expect positive, log/log relationship. And it only required three lines of code!</p>

<h1 id="to-conclude">To conclude</h1>

<p>These three use cases are (I think) good examples of what can be done with the <code>rmangal</code> package. I&#39;ll refine them a little bit to add in the paper. If you have nay any suggestions, that would be greatly appreciated as well!</p>

</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'tpoi-hp'; // required: replace example with your forum shortname

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


        </div>
      </div>

    </div>

  </body>
</html>
