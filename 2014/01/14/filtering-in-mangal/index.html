<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>These aren't the networks you're looking for</title>
        <meta name="viewport" content="width=device-width">

	   <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-11830706-1']);
		_gaq.push(['_trackPageview']);

		(function() {
		 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>
	
        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

        <link rel="stylesheet" href="/css/styles/github.css">
        <script src="/lib/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>


    </head>
    <body>

        <div class="site">
          <div class="header">
             <h1 class="title"><a href="/">Timothée Poisot</a></h1>
             <h2>Numerical and computational community ecologist</h2>
            <span class='nav'>
               <a class="extra" href="/papers/">papers</a>
               <a class="extra" href="/software/">software</a>
               <a class="extra" href="/research/">research</a>
               <a class="extra" href="/blog/">blog</a>
            </span>
          </div>

          <div class="content">
             <h2>These aren't the networks you're looking for</h2>
<p class="meta">14 Jan 2014</p>

<div class="post">
<p>The development of the <code>rmangal</code> package is making good progress. I just
finised implementing a way to filter results, which will be extremely useful
when the number of taxa and networks will start growing. Before we get into
how filtering is done, I’d like to take the opportunity to bore everyone
with technical details. <code>mangal</code> (the API) relies on <code>tastypie</code>, which is a
<code>django</code> plugin to use the data models as API resources (bored yet?). The
<code>tastypie</code> developers had the good taste to allow <code>django</code>’s ORM filter as
URL parameters to filter results. Or in short, there is a filtering solution
working out of the box.</p>

<p>The filtering is realtively easy to do, as it follows the common pattern:</p>

<pre><code>?field__relation=target
</code></pre>

<p>For example, to look for taxa whose name starts with <em>Lamellodiscus</em>, we
just need to append:</p>

<pre><code>?name__startswith=Lamellodiscus
</code></pre>

<h1 id="the-basics-of-filtering">The basics of filtering</h1>

<p>So how does it works in the <code>R</code> package? There is a <code>mangalSearch</code> function,
which takes as arguments the <code>api</code>, the type of resource to look for (the
list of resources can be now be viewed with <code>api$resources</code>), and a list of
filters. The filters are themselves <code>list</code> objects, with three properties:
<code>field</code>, <code>relation</code> (I give an overview of these below), and <code>target</code>. Let
me illustrate:</p>

<pre><code class="language-r">library(rmangal)
</code></pre>

<pre><code>## Loading required package: rjson
## Loading required package: httr
## Loading required package: igraph
## Loading required package: stringr
## Loading required package: cheddar
</code></pre>

<pre><code class="language-r">api &lt;- mangalapi("http://localhost:8000/")
Amphiprion &lt;- mangalSearch(api, "taxa", list(list(field = "name", relation = "startswith", 
    target = "Amphiprion")))
laply(Amphiprion, function(x) x$name)
</code></pre>

<pre><code>## [1] "Amphiprion clarkii"      "Amphiprion perideraion" 
## [3] "Amphiprion ocellaris"    "Amphiprion sandaracinos"
## [5] "Amphiprion melanopus"    "Amphiprion polymnus"
</code></pre>

<p>It may look like a convoluted way to do a simple thing, <em>but</em> the interest
is that you can combine filters to have more precise requests. Let’s say we
are really interested in a small portion of the pacific ocean, and want to
know if there are any networks inside. We will define two different filters:
one for latitude, and one for longitude.</p>

<pre><code class="language-r">filter_lat = list(field = "latitude", relation = "range", target = c(1.756, 
    1.813))
filter_lon = list(field = "longitude", relation = "range", target = c(124.76, 
    124.808))
Networks &lt;- mangalSearch(api, "network", list(filter_lat, filter_lon))
laply(Networks, function(x) x$name)
</code></pre>

<pre><code>## [1] "Batu Kapal"  "Jalan Masuk"
</code></pre>

<h1 id="types-of-relations">Types of relations</h1>

<p>There are ten different values for the <code>relation</code> type. <code>starswith</code> and
<code>endswith</code> will match the beginnign and end of the value. <code>exact</code> will match
the entirety of the field. <code>contains</code> will look for <code>target</code> somewhere in
the field. <code>in</code> will return objects that have <code>target</code> in the values of a
multi-valued field (example of use: with the identifier of an interactio,
find the network it belongs to). <code>range</code> will return all objects that have
values in the <code>target</code> range. And finally, <code>gte</code>, <code>gt</code>, <code>lte</code> and <code>lt</code>,
handle superior/inferior (or equal) relationships.</p>

<h1 id="more-advanced-usage">More advanced usage</h1>

<p>If you look at the code of <code>mangalSearch</code>, you’ll see that it passes
an addition argument (<code>filtering</code>) to <code>mangalList</code>. This allows you
to handle more complicated filtering schemes. In the filtering pattern
<code>field__relation=target</code>, <code>field</code> can actually be a <em>path</em> across multiple
objects. Let’s illustrate with an example.</p>

<p>We want to retrieve all interactions involving <code>taxa</code> whose name starts with
<code>Amphiprion</code>. The <em>path</em> from <code>interaction</code> to <code>taxa</code> goes through the field <code>taxa_to</code>/<code>taxa_from</code> in interaction. So what we want to do is:</p>

<pre><code>?taxa_from__name__startswith=Amphiprion
</code></pre>

<p>We can add that as the <code>filtering</code> argument of <code>mangalList</code>:</p>

<pre><code class="language-r">Interactions &lt;- rmangal:::mangalList(api, "interaction", filtering = "taxa_from__name__startswith=Amphiprion")
laply(Interactions, function(x) x$id)
</code></pre>

<pre><code>##  [1] "93"  "92"  "87"  "86"  "85"  "82"  "81"  "76"  "75"  "69"  "68" 
## [12] "67"  "59"  "58"  "53"  "52"  "51"  "50"  "45"  "44"  "23"  "24" 
## [23] "25"  "26"  "27"  "28"  "29"  "30"  "31"  "32"  "33"  "34"  "35" 
## [34] "36"  "37"  "38"  "39"  "41"  "42"  "43"  "44"  "45"  "46"  "47" 
## [45] "48"  "49"  "50"  "51"  "52"  "53"  "54"  "56"  "58"  "59"  "60" 
## [56] "61"  "62"  "64"  "65"  "66"  "67"  "68"  "69"  "71"  "72"  "73" 
## [67] "75"  "76"  "77"  "78"  "79"  "81"  "82"  "83"  "84"  "85"  "86" 
## [78] "87"  "88"  "89"  "90"  "91"  "92"  "93"  "95"  "96"  "97"  "98" 
## [89] "99"  "100" "101" "102" "103" "104" "105" "106"
</code></pre>

<p>Because <code>mangalList</code> is not exported, you have to use the <code>:::</code> operator
to explicitely call it. Note that these functions may not work (quite yet)
with the public database, because we will update the API later this week.</p>

</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'tpoi-hp'; // required: replace example with your forum shortname

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enab
          </div>

          <div class="footer">
            <div class="contact">
              <p>
                Timothée Poisot<br />
                Ecologist<br />
                t.poisot@gmail.com
              </p>
            </div>
            <div class="contact">
              <p>
                <a href="https://github.com/tpoisot/">github.com/tpoisot/</a><br />
                <a href="https://twitter.com/tpoi/">twitter.com/tpoi/</a><br />
              </p>
            </div>
          </div>
        </div>

    </body>
</html>
