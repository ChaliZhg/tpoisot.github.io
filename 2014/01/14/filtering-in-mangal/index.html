<!DOCTYPE html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="//use.typekit.net/kvz6lyh.js"></script>
<script>try{Typekit.load();}catch(e){}</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
   (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
   m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-11830706-1', 'timotheepoisot.fr');
ga('send', 'pageview');
</script>

<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/base-min.css">
<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/pure-min.css">
<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/grids-responsive-min.css">

<title>Timothée Poisot | These aren't the networks you're looking for</title>
<link rel="stylesheet" href="/styles/style.css" />

  </head>
<body>

<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
        <div class="header">
            <h1 class="brand-title">Timothée Poisot</h1>
            <h2 class="brand-tagline">Computational Ecologist</h2>
           <nav class="nav">
   <ul class="nav-list">
   <li><a href="/">Home</a></li>
   <li><a href="/software/">Software</a></li>
   <li><a href="/research/">Research</a></li>
   <li class="active"><a href="/blog/">Blog</a></li>
   <li><a href="/papers/">Papers</a></li>
   <li><a href="/colophon/">Colophon</a></li>
   </ul>
</nav>

        </div>
    </div>
    <div class="content pure-u-1 pure-u-md-3-4">
       <div class="entry">
<div class='post-date'>January 14, 2014 </div>
<div class='post-title'><a class="readmore" href="/2014/01/14/filtering-in-mangal/">These aren't the networks you're looking for</a></div>
<p>The development of the <code>rmangal</code> package is making good progress. I just finised implementing a way to filter results, which will be extremely useful when the number of taxa and networks will start growing. Before we get into how filtering is done, I’d like to take the opportunity to bore everyone with technical details. <code>mangal</code> (the API) relies on <code>tastypie</code>, which is a <code>django</code> plugin to use the data models as API resources (bored yet?). The <code>tastypie</code> developers had the good taste to allow <code>django</code>’s ORM filter as URL parameters to filter results. Or in short, there is a filtering solution working out of the box.</p>
<p>The filtering is realtively easy to do, as it follows the common pattern:</p>
<pre><code>?field__relation=target</code></pre>
<p>For example, to look for taxa whose name starts with <em>Lamellodiscus</em>, we just need to append:</p>
<pre><code>?name__startswith=Lamellodiscus</code></pre>
<h1 id="the-basics-of-filtering">The basics of filtering</h1>
<p>So how does it works in the <code>R</code> package? There is a <code>mangalSearch</code> function, which takes as arguments the <code>api</code>, the type of resource to look for (the list of resources can be now be viewed with <code>api$resources</code>), and a list of filters. The filters are themselves <code>list</code> objects, with three properties: <code>field</code>, <code>relation</code> (I give an overview of these below), and <code>target</code>. Let me illustrate:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rmangal)</code></pre>
<pre><code>## Loading required package: rjson
## Loading required package: httr
## Loading required package: igraph
## Loading required package: stringr
## Loading required package: cheddar</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">api &lt;-<span class="st"> </span><span class="kw">mangalapi</span>(<span class="st">&quot;http://localhost:8000/&quot;</span>)
Amphiprion &lt;-<span class="st"> </span><span class="kw">mangalSearch</span>(api, <span class="st">&quot;taxa&quot;</span>, <span class="kw">list</span>(<span class="kw">list</span>(<span class="dt">field =</span> <span class="st">&quot;name&quot;</span>, <span class="dt">relation =</span> <span class="st">&quot;startswith&quot;</span>, 
    <span class="dt">target =</span> <span class="st">&quot;Amphiprion&quot;</span>)))
<span class="kw">laply</span>(Amphiprion, function(x) x$name)</code></pre>
<pre><code>## [1] &quot;Amphiprion clarkii&quot;      &quot;Amphiprion perideraion&quot; 
## [3] &quot;Amphiprion ocellaris&quot;    &quot;Amphiprion sandaracinos&quot;
## [5] &quot;Amphiprion melanopus&quot;    &quot;Amphiprion polymnus&quot;</code></pre>
<p>It may look like a convoluted way to do a simple thing, <em>but</em> the interest is that you can combine filters to have more precise requests. Let’s say we are really interested in a small portion of the pacific ocean, and want to know if there are any networks inside. We will define two different filters: one for latitude, and one for longitude.</p>
<pre class="sourceCode r"><code class="sourceCode r">filter_lat =<span class="st"> </span><span class="kw">list</span>(<span class="dt">field =</span> <span class="st">&quot;latitude&quot;</span>, <span class="dt">relation =</span> <span class="st">&quot;range&quot;</span>, <span class="dt">target =</span> <span class="kw">c</span>(<span class="fl">1.756</span>, 
    <span class="fl">1.813</span>))
filter_lon =<span class="st"> </span><span class="kw">list</span>(<span class="dt">field =</span> <span class="st">&quot;longitude&quot;</span>, <span class="dt">relation =</span> <span class="st">&quot;range&quot;</span>, <span class="dt">target =</span> <span class="kw">c</span>(<span class="fl">124.76</span>, 
    <span class="fl">124.808</span>))
Networks &lt;-<span class="st"> </span><span class="kw">mangalSearch</span>(api, <span class="st">&quot;network&quot;</span>, <span class="kw">list</span>(filter_lat, filter_lon))
<span class="kw">laply</span>(Networks, function(x) x$name)</code></pre>
<pre><code>## [1] &quot;Batu Kapal&quot;  &quot;Jalan Masuk&quot;</code></pre>
<h1 id="types-of-relations">Types of relations</h1>
<p>There are ten different values for the <code>relation</code> type. <code>starswith</code> and <code>endswith</code> will match the beginnign and end of the value. <code>exact</code> will match the entirety of the field. <code>contains</code> will look for <code>target</code> somewhere in the field. <code>in</code> will return objects that have <code>target</code> in the values of a multi-valued field (example of use: with the identifier of an interactio, find the network it belongs to). <code>range</code> will return all objects that have values in the <code>target</code> range. And finally, <code>gte</code>, <code>gt</code>, <code>lte</code> and <code>lt</code>, handle superior/inferior (or equal) relationships.</p>
<h1 id="more-advanced-usage">More advanced usage</h1>
<p>If you look at the code of <code>mangalSearch</code>, you’ll see that it passes an addition argument (<code>filtering</code>) to <code>mangalList</code>. This allows you to handle more complicated filtering schemes. In the filtering pattern <code>field__relation=target</code>, <code>field</code> can actually be a <em>path</em> across multiple objects. Let’s illustrate with an example.</p>
<p>We want to retrieve all interactions involving <code>taxa</code> whose name starts with <code>Amphiprion</code>. The <em>path</em> from <code>interaction</code> to <code>taxa</code> goes through the field <code>taxa_to</code>/<code>taxa_from</code> in interaction. So what we want to do is:</p>
<pre><code>?taxa_from__name__startswith=Amphiprion</code></pre>
<p>We can add that as the <code>filtering</code> argument of <code>mangalList</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r">Interactions &lt;-<span class="st"> </span>rmangal:::<span class="kw">mangalList</span>(api, <span class="st">&quot;interaction&quot;</span>, <span class="dt">filtering =</span> <span class="st">&quot;taxa_from__name__startswith=Amphiprion&quot;</span>)
<span class="kw">laply</span>(Interactions, function(x) x$id)</code></pre>
<pre><code>##  [1] &quot;93&quot;  &quot;92&quot;  &quot;87&quot;  &quot;86&quot;  &quot;85&quot;  &quot;82&quot;  &quot;81&quot;  &quot;76&quot;  &quot;75&quot;  &quot;69&quot;  &quot;68&quot; 
## [12] &quot;67&quot;  &quot;59&quot;  &quot;58&quot;  &quot;53&quot;  &quot;52&quot;  &quot;51&quot;  &quot;50&quot;  &quot;45&quot;  &quot;44&quot;  &quot;23&quot;  &quot;24&quot; 
## [23] &quot;25&quot;  &quot;26&quot;  &quot;27&quot;  &quot;28&quot;  &quot;29&quot;  &quot;30&quot;  &quot;31&quot;  &quot;32&quot;  &quot;33&quot;  &quot;34&quot;  &quot;35&quot; 
## [34] &quot;36&quot;  &quot;37&quot;  &quot;38&quot;  &quot;39&quot;  &quot;41&quot;  &quot;42&quot;  &quot;43&quot;  &quot;44&quot;  &quot;45&quot;  &quot;46&quot;  &quot;47&quot; 
## [45] &quot;48&quot;  &quot;49&quot;  &quot;50&quot;  &quot;51&quot;  &quot;52&quot;  &quot;53&quot;  &quot;54&quot;  &quot;56&quot;  &quot;58&quot;  &quot;59&quot;  &quot;60&quot; 
## [56] &quot;61&quot;  &quot;62&quot;  &quot;64&quot;  &quot;65&quot;  &quot;66&quot;  &quot;67&quot;  &quot;68&quot;  &quot;69&quot;  &quot;71&quot;  &quot;72&quot;  &quot;73&quot; 
## [67] &quot;75&quot;  &quot;76&quot;  &quot;77&quot;  &quot;78&quot;  &quot;79&quot;  &quot;81&quot;  &quot;82&quot;  &quot;83&quot;  &quot;84&quot;  &quot;85&quot;  &quot;86&quot; 
## [78] &quot;87&quot;  &quot;88&quot;  &quot;89&quot;  &quot;90&quot;  &quot;91&quot;  &quot;92&quot;  &quot;93&quot;  &quot;95&quot;  &quot;96&quot;  &quot;97&quot;  &quot;98&quot; 
## [89] &quot;99&quot;  &quot;100&quot; &quot;101&quot; &quot;102&quot; &quot;103&quot; &quot;104&quot; &quot;105&quot; &quot;106&quot;</code></pre>
<p>Because <code>mangalList</code> is not exported, you have to use the <code>:::</code> operator to explicitely call it. Note that these functions may not work (quite yet) with the public database, because we will update the API later this week.</p>
<div class="references">

</div>

</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'tpoi-hp'; // required: replace example with your forum shortname

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


    </div>
</div>


</body>
</html>
