<!DOCTYPE html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Timothée Poisot | These aren't the networks you're looking for</title>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
extensions: ["tex2jax.js"],
jax: ["input/TeX", "output/HTML-CSS"],
tex2jax: {
inlineMath: [ ['$','$'], ["\\(","\\)"] ],
displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
processEscapes: true
},
"HTML-CSS": { availableFonts: ["TeX"] }
});
</script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
   (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
   m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-11830706-1', 'timotheepoisot.fr');
ga('send', 'pageview');
</script>

<link rel="stylesheet" href="/lib/skeleton/css/normalize.css">
<link rel="stylesheet" href="/lib/skeleton/css/skeleton.css">

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script type="text/javascript" src="/lib/site.js" charset="utf-8"></script>

<link rel="stylesheet/less" type="text/css" href="/lib/style.less" />
<script src="//cdnjs.cloudflare.com/ajax/libs/less.js/2.3.1/less.min.js"></script>

<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

  </head>
  <body><a id="pagetop"></a>

    <!-- .container is main centered wrapper -->
    <div class="container">

      <div class="head">
        <h1>Timothée Poisot</h1>
        <h2>Computational Ecologist</h2>
      </div>

      <nav class="navbar">
  <div class="container">
    <ul class="nav-list">
      <li>
        <a href="/" title="Home">
          <span class="hicon"><i class="fa fa-fw fa-home"></i>
          </span><span class="text">Home</span>
        </a>
      </li>
      <li>
        <a href="/software/" title="Software">
          <span class="hicon"><i class="fa fa-fw fa-terminal"></i>
          </span><span class="text">Software</span>
        </a>
      </li>
      <li>
        <a href="/research/" title="Research">
          <span class="hicon"><i class="fa fa-fw fa-flask"></i>
          </span><span class="text">Research</span>
        </a>
      </li>
      <li>
        <a href="/blog/" class="active" title="Blog">
          <span class="hicon"><i class="fa fa-fw fa-bullhorn"></i>
          </span><span class="text">Blog</span>
        </a>
      </li>
      <li>
        <a href="/papers/" title="Papers">
          <span class="hicon"><i class="fa fa-fw fa-file-text-o"></i>
          </span><span class="text">Papers</span>
        </a>
      </li>
      <li>
        <a href="/colophon/" title="Colophon">
          <span class="hicon"><i class="fa fa-fw fa-info"></i>
          </span><span class="text">Colophon</span>
        </a>
      </li>
    </ul>
  </div>
</nav>


      <!-- columns should be the immediate child of a .row -->
      <div class="row">
        <div class="twelve column content">
          <div class="entry">
<div class='post-title'>2014/01/14<a class="readmore" href="/2014/01/14/filtering-in-mangal/">These aren't the networks you're looking for</a></div>
<div class='post-meta'>Written by Tim</div>
<p>The development of the <code>rmangal</code> package is making good progress. I just
finised implementing a way to filter results, which will be extremely useful
when the number of taxa and networks will start growing. Before we get into
how filtering is done, I&#39;d like to take the opportunity to bore everyone
with technical details. <code>mangal</code> (the API) relies on <code>tastypie</code>, which is a
<code>django</code> plugin to use the data models as API resources (bored yet?). The
<code>tastypie</code> developers had the good taste to allow <code>django</code>&#39;s ORM filter as
URL parameters to filter results. Or in short, there is a filtering solution
working out of the box.</p>

<p>The filtering is realtively easy to do, as it follows the common pattern:</p>
<div class="highlight"><pre><code class="language-" data-lang="">?field__relation=target
</code></pre></div>
<p>For example, to look for taxa whose name starts with <em>Lamellodiscus</em>, we
just need to append:</p>
<div class="highlight"><pre><code class="language-" data-lang="">?name__startswith=Lamellodiscus
</code></pre></div>
<h1 id="the-basics-of-filtering">The basics of filtering</h1>

<p>So how does it works in the <code>R</code> package? There is a <code>mangalSearch</code> function,
which takes as arguments the <code>api</code>, the type of resource to look for (the
list of resources can be now be viewed with <code>api$resources</code>), and a list of
filters. The filters are themselves <code>list</code> objects, with three properties:
<code>field</code>, <code>relation</code> (I give an overview of these below), and <code>target</code>. Let
me illustrate:</p>
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">rmangal</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">## Loading required package: rjson
## Loading required package: httr
## Loading required package: igraph
## Loading required package: stringr
## Loading required package: cheddar
</code></pre></div><div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">api</span> <span class="o">&lt;-</span> <span class="n">mangalapi</span><span class="p">(</span><span class="s2">"http://localhost:8000/"</span><span class="p">)</span>
<span class="n">Amphiprion</span> <span class="o">&lt;-</span> <span class="n">mangalSearch</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="s2">"taxa"</span><span class="p">,</span> <span class="n">list</span><span class="p">(</span><span class="n">list</span><span class="p">(</span><span class="n">field</span> <span class="o">=</span> <span class="s2">"name"</span><span class="p">,</span> <span class="n">relation</span> <span class="o">=</span> <span class="s2">"startswith"</span><span class="p">,</span> 
    <span class="n">target</span> <span class="o">=</span> <span class="s2">"Amphiprion"</span><span class="p">)))</span>
<span class="n">laply</span><span class="p">(</span><span class="n">Amphiprion</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">x</span><span class="o">$</span><span class="n">name</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">## [1] "Amphiprion clarkii"      "Amphiprion perideraion" 
## [3] "Amphiprion ocellaris"    "Amphiprion sandaracinos"
## [5] "Amphiprion melanopus"    "Amphiprion polymnus"
</code></pre></div>
<p>It may look like a convoluted way to do a simple thing, <em>but</em> the interest
is that you can combine filters to have more precise requests. Let&#39;s say we
are really interested in a small portion of the pacific ocean, and want to
know if there are any networks inside. We will define two different filters:
one for latitude, and one for longitude.</p>
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">filter_lat</span> <span class="o">=</span> <span class="n">list</span><span class="p">(</span><span class="n">field</span> <span class="o">=</span> <span class="s2">"latitude"</span><span class="p">,</span> <span class="n">relation</span> <span class="o">=</span> <span class="s2">"range"</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="m">1.756</span><span class="p">,</span> 
    <span class="m">1.813</span><span class="p">))</span>
<span class="n">filter_lon</span> <span class="o">=</span> <span class="n">list</span><span class="p">(</span><span class="n">field</span> <span class="o">=</span> <span class="s2">"longitude"</span><span class="p">,</span> <span class="n">relation</span> <span class="o">=</span> <span class="s2">"range"</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="m">124.76</span><span class="p">,</span> 
    <span class="m">124.808</span><span class="p">))</span>
<span class="n">Networks</span> <span class="o">&lt;-</span> <span class="n">mangalSearch</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="s2">"network"</span><span class="p">,</span> <span class="n">list</span><span class="p">(</span><span class="n">filter_lat</span><span class="p">,</span> <span class="n">filter_lon</span><span class="p">))</span>
<span class="n">laply</span><span class="p">(</span><span class="n">Networks</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">x</span><span class="o">$</span><span class="n">name</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">## [1] "Batu Kapal"  "Jalan Masuk"
</code></pre></div>
<h1 id="types-of-relations">Types of relations</h1>

<p>There are ten different values for the <code>relation</code> type. <code>starswith</code> and
<code>endswith</code> will match the beginnign and end of the value. <code>exact</code> will match
the entirety of the field. <code>contains</code> will look for <code>target</code> somewhere in
the field. <code>in</code> will return objects that have <code>target</code> in the values of a
multi-valued field (example of use: with the identifier of an interactio,
find the network it belongs to). <code>range</code> will return all objects that have
values in the <code>target</code> range. And finally, <code>gte</code>, <code>gt</code>, <code>lte</code> and <code>lt</code>,
handle superior/inferior (or equal) relationships.</p>

<h1 id="more-advanced-usage">More advanced usage</h1>

<p>If you look at the code of <code>mangalSearch</code>, you&#39;ll see that it passes
an addition argument (<code>filtering</code>) to <code>mangalList</code>. This allows you
to handle more complicated filtering schemes. In the filtering pattern
<code>field__relation=target</code>, <code>field</code> can actually be a <em>path</em> across multiple
objects. Let&#39;s illustrate with an example.</p>

<p>We want to retrieve all interactions involving <code>taxa</code> whose name starts with
<code>Amphiprion</code>. The <em>path</em> from <code>interaction</code> to <code>taxa</code> goes through the field <code>taxa_to</code>/<code>taxa_from</code> in interaction. So what we want to do is:</p>
<div class="highlight"><pre><code class="language-" data-lang="">?taxa_from__name__startswith=Amphiprion
</code></pre></div>
<p>We can add that as the <code>filtering</code> argument of <code>mangalList</code>:</p>
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">Interactions</span> <span class="o">&lt;-</span> <span class="n">rmangal</span><span class="o">:::</span><span class="n">mangalList</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="s2">"interaction"</span><span class="p">,</span> <span class="n">filtering</span> <span class="o">=</span> <span class="s2">"taxa_from__name__startswith=Amphiprion"</span><span class="p">)</span>
<span class="n">laply</span><span class="p">(</span><span class="n">Interactions</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">x</span><span class="o">$</span><span class="n">id</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">##  [1] "93"  "92"  "87"  "86"  "85"  "82"  "81"  "76"  "75"  "69"  "68" 
## [12] "67"  "59"  "58"  "53"  "52"  "51"  "50"  "45"  "44"  "23"  "24" 
## [23] "25"  "26"  "27"  "28"  "29"  "30"  "31"  "32"  "33"  "34"  "35" 
## [34] "36"  "37"  "38"  "39"  "41"  "42"  "43"  "44"  "45"  "46"  "47" 
## [45] "48"  "49"  "50"  "51"  "52"  "53"  "54"  "56"  "58"  "59"  "60" 
## [56] "61"  "62"  "64"  "65"  "66"  "67"  "68"  "69"  "71"  "72"  "73" 
## [67] "75"  "76"  "77"  "78"  "79"  "81"  "82"  "83"  "84"  "85"  "86" 
## [78] "87"  "88"  "89"  "90"  "91"  "92"  "93"  "95"  "96"  "97"  "98" 
## [89] "99"  "100" "101" "102" "103" "104" "105" "106"
</code></pre></div>
<p>Because <code>mangalList</code> is not exported, you have to use the <code>:::</code> operator
to explicitely call it. Note that these functions may not work (quite yet)
with the public database, because we will update the API later this week.</p>

</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'tpoi-hp'; // required: replace example with your forum shortname

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


        </div>
      </div>

    </div>

  </body>
</html>
