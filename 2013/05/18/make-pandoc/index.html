
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="author" content="Timothée Poisot" />
    <title>Tim Poisot :: Using make and pandoc for reproducible papers</title>

    <link rel="stylesheet" href="/assets/themes/thescientist/css/core.css" media="screen"/> 
    <link rel="stylesheet" href="/assets/themes/thescientist/css/mobile.css" media="handheld, only screen and (max-device-width:480px)"/>
    <link rel="stylesheet" href="/assets/themes/thescientist/css/pygment.css" />
    
    <script type="text/javascript" src="//use.typekit.net/kvz6lyh.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
    <script src="http://d3js.org/d3.v3.min.js"></script>

    
      <link rel="alternate" type="application/atom+xml" title="RSS Feed for Tim's blog" href="http://feeds.feedburner.com/timpoisot" />
    

    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    


  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-11830706-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>



  </head>
  <body>
    <div class="wrapper">
      <div class='precontent'>
        <div class='siteinfos'>
          <h1><a href="http://timotheepoisot.fr">Tim Poisot</a></h1>
          <div class='nav'>
          <ul class='main-nav'>
            <li><a class="extra navlink homelink" href="/">About</a></li>
            <li><a class="extra navlink reslink" href="/research/">Research</a></li>
            <li><a class="extra navlink paplink" href="/papers/">Papers</a></li>
            <li><a class="extra navlink codelink" href="/code/">Code</a></li>     
            <li><a class="extra navlink bloglink" href="/blog/">Blog</a></li>
          </ul>
        </div>
        </div>
      </div>

      <section class='content'>
      
<section>
	<div class='pbody'>

		<h1 class='ptitle'>Using make and pandoc for reproducible papers</h1>
		<span class='margin'>
			May 18, 2013<br />
			575 words <br />	
			Taggs:
			
				<a class='post-tag' href="/tags/#open lab book-ref" title="tag">open lab book</a>,&nbsp;
			
				<a class='post-tag' href="/tags/#pandoc-ref" title="tag">pandoc</a>
			
		</span>

		<p>I tend to use <a href="http://johnmacfarlane.net/pandoc/"><code>pandoc</code></a> more and more to
write my papers. The syntax of markdown is ligthweight, doesn't get in the way
of my writing, and it's easy to export the text to almost any format you can
name afterward. The only issue I ran in is that I also like
<a href="http://pgfplots.sourceforge.net/"><code>pgfplots</code></a> a lot for graphics, because they
come with the ability to update themselves at each compilation, when the data
are re-generated. It's quite important if you want to tweak som simulation
parameters, for instance. Using <code>pgfplots</code> from within <code>pandoc</code> can be done, but
the heavy syntax seems rather clumsy.</p>

<p>So I started looking at what <code>gnuplot</code> can do, and as it turns out, <code>gnuplot</code> can do <em>a lot</em>. Look at the <a href="http://gnuplot.sourceforge.net/demo_cvs/">demo gallery</a> or the excellent <a href="http://www.gnuplotting.org/">gnuplotting</a> if you want to see more. So anyway, I started looking for a way to make the whole process or generating data, getting them in figures, and then keeping the paper updated, as seemless as it <em>should</em> be (because awesome technology should make our lives awesomely simple). Then I discovered <code>makefiles</code>, and I think there's no coming back from that. The extremely impressive <a href="http://bost.ocks.org/mike/make/">Mike Bostock</a> (if you are into data visualization, check his stuff out), gives good arguments about why you should use them. I spent a few minutes setting up an example, and I'm deeply in love with the concept.</p>

<p>Here it goes. Assume that you have a file for your paper, called <code>paper.md</code>. You
need to get it into <code>paper.pdf</code>. This <code>paper.md</code> file needs a <code>fig1.png</code> figure
to compile. <code>fig1.png</code> is produced by <code>fig1.plt</code>, a <code>gnuplot</code> script, who will
read <code>data.txt</code>, itself generated by <code>script.py</code>.</p>

<p>A pre-<code>make</code> workflow would look like this:</p>

<div class="highlight"><pre><code class="bash">python script.py &gt; data.txt
gnuplot fig1.plt
pandoc paper1.md -o paper1.pdf
</code></pre>
</div>


<p>Incidentally, I used this type of files, usually called some variation of
<code>compile.sh</code>, all the time. But as I discovered, you can make the whole process
<em>painless</em>. and time saving, since you can only compile the parts that are
needed. How, you ask? Using a <code>makefile</code>. For this simple example, the
<code>Makefile</code> looks like this:</p>

<div class="highlight"><pre><code class="makefile"><span class="nf">all</span><span class="o">:</span> <span class="m">paper.pdf</span>

<span class="nf">paper.pdf</span><span class="o">:</span> <span class="m">paper.md fig1.png script.py</span>
  pandoc paper.md -o paper.pdf

<span class="nf">fig1.png</span><span class="o">:</span> <span class="m">data.txt fig1.plt</span>
  gnuplot fig1.plt

<span class="nf">data.txt</span><span class="o">:</span> <span class="m">script.py</span>
  python script.py &gt; data.txt
</code></pre>
</div>


<p>All <code>Makefile</code>s look the same: on the first line, there is a <em>target</em>, followed
by its <em>dependencies</em>. Then, on the line below, are the <em>commands</em>. Everytime
a dependency is also a target, then if the dependencies of this target have
changed, the dependency is rebuilt. OK that's not clear at all. If you change
<code>script.py</code>, the next time you build <code>fig1.png</code>, the files that <code>fig1.png</code>
depend on that have <code>script.py</code> as a dependency will be rebuilt. But see it the
other way around. If you just modified the text of your <code>paper.md</code> file, then
there is no reason to re-build any of the figures or dataset. See? That's the
greatness of <code>make</code>.</p>

<p>The <code>all</code> rule here is just having <code>paper.pdf</code> as a dependency. So if I type
<code>make all</code>, then if will go to the line starting by <code>paper.pdf</code>, and work its
way from here. If I just need to see the figure to show it to a colleague, then
I have no need for the <code>pdf</code>, and a simple <code>make fig1.png</code> will do the job.</p>

<p><strong>TL;DR</strong> The command line is so great. <code>make</code> is awesome. Being a nerd saves energy.</p>


		<div id="page-navigation">

        		<div class="left">
	        		
	                	Previous post: <a href="/2013/05/16/steal-my-paper/" title="Previous Post: Steal my paper! (seriously, please, don't)">Steal my paper! (seriously, please, don't)</a>
	        		
        		</div>

		        <div class="right">
			        
		        </div>
		</div> 

		


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'tpoi-hp'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




	</div>
</section>
<span
	class="Z3988" 
	title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Adc&amp;rfr_id=info%3Asid%2Focoins.info%3Agenerator&amp;rft.title=Using make and pandoc for reproducible papers&amp;rft.creator=Timothée Poisot&amp;rft.date=2013-05-18&amp;rft.language=EN&amp;rft.rights=CC-BY-SA&amp;rft_id=http://timotheepoisot.fr/2013/05/18/make-pandoc/">
</span>

      </section>

      <div class='footer'>
          <p>
            This website uses <a href="http://jekyllbootstrap.com/">Jekyll Bootstrap</a> and is hosted at <a href="http://pages.github.com/">GitHub pages</a>.<p />
            The contents of this website are under the <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">Creative Commons</a> BY-SA licence 3.0.
          </p>
      </div>
      
    </div>
    <!--[if !IE]><script>fixScale(document);</script><!--<![endif]-->
  </body>
</html>

