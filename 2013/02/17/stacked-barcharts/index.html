<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8" />
   <link rel="stylesheet" href="/css/normalize.css">
	<link rel="stylesheet" href="/css/foundation.min.css">
   <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
   <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
	<link rel="stylesheet" href="/css/d3.css" />
	<link rel="stylesheet" href="/css/pygments.css" />
   <link rel="stylesheet/less" type="text/css" href="/css/tim.less" />
   <script type="text/javascript" src="/lib/less.js"></script>
   <script src="http://d3js.org/d3.v3.min.js"></script>
   <link rel="alternate" type="application/atom+xml" title="RSS Feed for Tim's blog" href="http://feeds.feedburner.com/timpoisot" />
    
    <script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-11830706-1']);
		_gaq.push(['_trackPageview']);

		(function() {
		 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>
	
	<meta name="author" content="Tim Poisot" />
   <title>Timothée Poisot :: An alternative to stacked bar charts</title>
    
</head>

<body>
<a id="top"></a>
<div id="main">

<div class="row content">
   <div class = "row copy">
   <div class="large-9 small-10 columns maintext">
   <div class='post'>
<h1>An alternative to stacked bar charts</h1>

   <div class="postinfo">
      February 17, 2013 &mdash; <span class="label radius small secondary" style="margin-right: 3px;"><a href="/tag/data visualization/">data visualization</a></span>
   </div>


<p>I hate stacked bar charts. I see them in so many papers, using the awful Excel default options, and I hate them. I feel them visually unappealing, confusing, and extremely inefficient at displaying information. It&#39;s almost impossible to compare the size of two bars without measuring them, which means that they carry less information than a good old table. So I was looking for alternatives to them. Here is the code I ended up with.</p>

<p>First let&#39;s load a few packages, and generate some random abundance data. Let&#39;s imagine that we have 10 sites, and we sample 20 species.</p>

<div class="highlight"><pre><code class="splus">library<span class="p">(</span>RColorBrewer<span class="p">)</span>

Abund <span class="o">=</span> round<span class="p">(</span>matrix<span class="p">(</span>runif<span class="p">(</span><span class="m">200</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">),</span>nc<span class="o">=</span><span class="m">10</span><span class="p">),</span><span class="m">2</span><span class="p">)</span>
Abund <span class="o">=</span> Abund<span class="o">/</span>max<span class="p">(</span>Abund<span class="p">)</span>

rownames<span class="p">(</span>Abund<span class="p">)</span> <span class="o">=</span> LETTERS<span class="p">[</span>c<span class="p">(</span><span class="m">1</span><span class="o">:</span>nrow<span class="p">(</span>Abund<span class="p">))]</span>
colnames<span class="p">(</span>Abund<span class="p">)</span> <span class="o">=</span> letters<span class="p">[</span>c<span class="p">(</span><span class="m">1</span><span class="o">:</span>ncol<span class="p">(</span>Abund<span class="p">))]</span>

pal <span class="o">=</span> colorRampPalette<span class="p">(</span>brewer.pal<span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="s">&#39;Paired&#39;</span><span class="p">))(</span>nrow<span class="p">(</span>Abund<span class="p">))</span>
</code></pre></div>

<p>This will give us a site/abundance matrix. The next step is to create a plot with nothing in it:</p>

<div class="highlight"><pre><code class="splus">par<span class="p">(</span>las<span class="o">=</span><span class="m">2</span><span class="p">)</span>
X <span class="o">=</span> c<span class="p">(</span><span class="m">1</span><span class="o">:</span>nrow<span class="p">(</span>Abund<span class="p">))</span>
Y <span class="o">=</span> c<span class="p">(</span><span class="m">1</span><span class="o">:</span>ncol<span class="p">(</span>Abund<span class="p">))</span>
image<span class="p">(</span>X<span class="p">,</span>Y<span class="p">,</span>Abund<span class="p">,</span>col<span class="o">=</span><span class="s">&#39;white&#39;</span><span class="p">,</span>axes<span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span>bty<span class="o">=</span><span class="s">&#39;n&#39;</span><span class="p">)</span>
</code></pre></div>

<p><span class='margin'>It&#39;s easy to make it so that the width of each sub-plot is proportional to the relative abundance of each species.</span>Then, for each row/line (and I&#39;m aware this is not optimized at all), we will draw a vertical bar. Each taxon (<em>i.e.</em> each column in our graph) will have its own sub-plot. The size can be fixed, or equal. But this allows comparison of species abundances across dates.</p>

<div class="highlight"><pre><code class="splus"><span class="kr">for</span><span class="p">(</span>ro <span class="kr">in</span> <span class="m">1</span><span class="o">:</span>nrow<span class="p">(</span>Abund<span class="p">)){</span>
    <span class="kr">for</span><span class="p">(</span>co <span class="kr">in</span> <span class="m">1</span><span class="o">:</span>ncol<span class="p">(</span>Abund<span class="p">)){</span>
        rect<span class="p">(</span>ro<span class="m">-0.5</span><span class="p">,</span> co<span class="m">-0.4</span><span class="p">,</span> ro<span class="m">-0.5</span><span class="o">+</span>Abund<span class="p">[</span>ro<span class="p">,</span>co<span class="p">]</span><span class="o">*</span><span class="m">0.9</span><span class="p">,</span> co<span class="m">+0.4</span><span class="p">,</span>border<span class="o">=</span><span class="kc">NA</span><span class="p">,</span>col<span class="o">=</span>pal<span class="p">[</span>ro<span class="p">])</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Finally, let&#39;s add reference lines for each species, and the site/species names on axes:</p>

<div class="highlight"><pre><code class="splus">abline<span class="p">(</span>v<span class="o">=</span>X<span class="m">-0.5</span><span class="p">,</span>col<span class="o">=</span><span class="s">&#39;darkgrey&#39;</span><span class="p">,</span>lwd<span class="o">=</span><span class="m">2</span><span class="p">)</span>
axis<span class="p">(</span><span class="m">2</span><span class="p">,</span>at<span class="o">=</span>c<span class="p">(</span><span class="m">1</span><span class="o">:</span>ncol<span class="p">(</span>Abund<span class="p">)),</span>labels<span class="o">=</span>colnames<span class="p">(</span>Abund<span class="p">),</span>col<span class="o">=</span><span class="kc">NA</span><span class="p">)</span>
axis<span class="p">(</span><span class="m">1</span><span class="p">,</span>at<span class="o">=</span>c<span class="p">(</span><span class="m">1</span><span class="o">:</span>nrow<span class="p">(</span>Abund<span class="p">)),</span>labels<span class="o">=</span>rownames<span class="p">(</span>Abund<span class="p">),</span>col<span class="o">=</span><span class="kc">NA</span><span class="p">)</span>
</code></pre></div>

<p>This gives the final result:</p>

<p><img src="/images/stackedbar.png" alt="Figure1 - grouped bar chart" title="bar chart"></p>

<p>I find it much easier to eyeball the variation of species abundance across sites. And if instead of sites you have dates, then by reading each column, you can get and idea of the population dynamics (which is usually impossible to do for stacked bar charts, except for the bottom series). This is far from perfect, but that will do the job for exploratory work.</p>


</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'tpoi-hp'; // required: replace example with your forum shortname

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

<ul class="pager">


<li class="previous">
<a href="/2013/02/13/edges-contribution-modularity/">&larr; Previous post</a>
</li>



<li class="next">
<a href="/2013/02/18/stacked-barcharts-d3/">Next post &rarr;</a>
</li>


</ul>


   </div>
   <div class="large-3 small-2 columns">
      <div class='header'>
         <h1>Timothée Poisot</h1>
<h2>Spatial ecology of species interactions</h2>

         <ul class="no-bullet main-nav">
   <li><a href="/">Home</a></li>
   <li><a href="/papers/">Papers</a></li>
   <li><a href="/software/">Software</a></li>
   <li><a href="/research/">Research</a></li>
   <li class="active"><a href="/blog/">Blog</a></li>
</ul>

         <a class='top' href="#top"><i class="fa fa-arrow-circle-up"></i></a>
      </div>
   </div>
   </div>

   <div class="row footer">
         <div class="small-4 columns">
<h5>Contact</h5>
<ul class='no-bullet'>
   <li><i class="fa fa-fw fa-envelope"></i> <a href="mailto:t.poisot@gmail.com">E-mail</a></li>
   <li><i class="fa fa-fw fa-twitter-square"></i> <code>@tpoi</code> on <a href="http://twitter.com/tpoi/">Twitter</a></li>
   <li><i class="fa fa-fw fa-github-square"></i> <code>tpoisot</code> on <a href="http://github.com/tpoisot/">GitHub</a></li>
   <li><i class="fa fa-fw fa-rss-square"></i> <a href="http://feeds.feedburner.com/timpoisot/">RSS feed for new posts</a></li>
</ul>
</div>

<div class="small-8 columns">
   <h5>Most recent posts</h5>
   <ul class='no-bullet'>
   
   <li><span class='date'>11 Jan 2014</span> <a href="/2014/01/11/animate-networks-with-igraph/">Animate networks with igraph</a></li>
   
   <li><span class='date'>09 Jan 2014</span> <a href="/2014/01/09/mangal-in-action/">Examples of mangal in action</a></li>
   
   <li><span class='date'>08 Jan 2014</span> <a href="/2014/01/08/mangal-add-data/">Uploading data into mangal</a></li>
   
   <li><span class='date'>07 Jan 2014</span> <a href="/2014/01/07/mangal-database-networks/">Introducing mangal, a database for ecological networks</a></li>
   
   </ul>
</div>


<div class="small-8 columns">
   <h5>Colophon</h5>
   <p>
	  This website uses <a href='http://foundation.zurb.com/'>Foundation
	  5</a>, <a href='http://fortawesome.github.io/Font-Awesome/'>Font
	  Awesome</a>, is built with <a
	  href='https://github.com/mojombo/jekyll'>Jekyll</a>, and hosted by <a
	  href='http://pages.github.com/'>GitHub pages</a>. Contents under the
	  <a href='http://creativecommons.org/licenses/by-sa/3.0/deed.en_US'>CC
	  BY-SA 3.0</a> licence.
   </p>
</div>


   </div>

</div>


</div>

</body>

</html>
